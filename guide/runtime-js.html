<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>脚本执行时间 | 快应用性能优化实践</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="通过学习文档中快应用的优化方法，让您快速提升您得快应用性能">
    
    <link rel="preload" href="/scoring/assets/css/0.styles.b2f7e813.css" as="style"><link rel="preload" href="/scoring/assets/js/app.1668d037.js" as="script"><link rel="preload" href="/scoring/assets/js/2.3be33aa9.js" as="script"><link rel="preload" href="/scoring/assets/js/3.e949fc0c.js" as="script"><link rel="prefetch" href="/scoring/assets/js/10.24381f1f.js"><link rel="prefetch" href="/scoring/assets/js/11.de84838b.js"><link rel="prefetch" href="/scoring/assets/js/12.845136b4.js"><link rel="prefetch" href="/scoring/assets/js/13.87ad0628.js"><link rel="prefetch" href="/scoring/assets/js/4.3236f850.js"><link rel="prefetch" href="/scoring/assets/js/5.a5298639.js"><link rel="prefetch" href="/scoring/assets/js/6.5b271d09.js"><link rel="prefetch" href="/scoring/assets/js/7.95400c41.js"><link rel="prefetch" href="/scoring/assets/js/8.22e3eceb.js"><link rel="prefetch" href="/scoring/assets/js/9.76817e02.js">
    <link rel="stylesheet" href="/scoring/assets/css/0.styles.b2f7e813.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/scoring/" class="home-link router-link-active"><!----> <span class="site-name">快应用性能优化实践</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开始</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>运行时优化</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/scoring/guide/runtime-js.html" aria-current="page" class="active sidebar-link">脚本执行时间</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/scoring/guide/runtime-js.html#生成火焰图" class="sidebar-link">生成火焰图</a></li><li class="sidebar-sub-header"><a href="/scoring/guide/runtime-js.html#通过火焰图优化耗时脚本" class="sidebar-link">通过火焰图优化耗时脚本</a></li><li class="sidebar-sub-header"><a href="/scoring/guide/runtime-js.html#其他优化手段" class="sidebar-link">其他优化手段</a></li></ul></li><li><a href="/scoring/guide/runtime-dom.html" class="sidebar-link">DOM 优化</a></li><li><a href="/scoring/guide/runtime-network.html" class="sidebar-link">网络耗时优化</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>rpk包大小优化</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="脚本执行时间"><a href="#脚本执行时间" class="header-anchor">#</a> 脚本执行时间</h1> <p>脚本执行时间是指 JS 脚本在一次同步执行中消耗的时间，比如生命周期回调、事件处理函数的同步执行时间。执行脚本的耗时过长会让用户觉得卡顿，体验较差，出现这一情况时，需要确认并优化脚本的逻辑</p> <h2 id="生成火焰图"><a href="#生成火焰图" class="header-anchor">#</a> 生成火焰图</h2> <p>和传统 H5 类似，在快应用中也可以使用火焰图观察各个方法执行的时间。</p> <p>在快应用中有两种方式查看火焰图，开发者选择其中一种即可。</p> <h3 id="使用-inspector-接口生成火焰图"><a href="#使用-inspector-接口生成火焰图" class="header-anchor">#</a> 使用 inspector 接口生成火焰图</h3> <p>inspector 接口的说明可以查看<a href="https://doc.quickapp.cn/features/system/inspector.html#inspector-1080" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>该节主要包括的内容</p> <ul><li>生成并保存 chrome devtools performance 面板所需的 profile.cpuprofile</li> <li>PC 获取 profile.cpuprofile 文件</li> <li>通过 profile.cpuprofile 文件查看火焰图</li></ul> <h4 id="生成-profile-cpuprofile-文件"><a href="#生成-profile-cpuprofile-文件" class="header-anchor">#</a> 生成 profile.cpuprofile 文件</h4> <ul><li>在项目的 app.ux 中添加代码，这段代码主要做了两件事：记录四秒的执行信息，将信息存到手机内存的文件里</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> file <span class="token keyword">from</span> <span class="token string">'@system.file'</span>
<span class="token keyword">import</span> prompt <span class="token keyword">from</span> <span class="token string">'@system.prompt'</span>

<span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Session</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
session<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
session<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'Profiler.enable'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  session<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'Profiler.start'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 记录四秒的执行信息</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      session<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'Profiler.stop'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> <span class="token punctuation">{</span> profile <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        session<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 将记录的信息存起来</span>
        file<span class="token punctuation">.</span><span class="token function">writeText</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          uri<span class="token operator">:</span> <span class="token string">'internal://mass/profile.cpuprofile'</span><span class="token punctuation">,</span>
          text<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>profile<span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            prompt<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'handling success'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            prompt<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">handling fail, code = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">4000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="将保存的文件提取到电脑里"><a href="#将保存的文件提取到电脑里" class="header-anchor">#</a> 将保存的文件提取到电脑里</h4> <p>获取保存的文件前，需要确定运行的快应用引擎包名（appName）和快应用的包名(rpkName)，本例中用到的 OPPO 快应用引擎包名为 com.nearme.instant.platform，快应用包名为 com.example.demo</p> <ul><li>如果电脑安装了 adb，可以执行下面命令直接获取刚才保存到手机中的 profile.cpuprofile 文件。调试时请注意替换自己的包名和拉取到电脑后存放的位置</li></ul> <div class="language- extra-class"><pre class="language-text"><code>adb pull /storage/emulated/0/Android/data/com.nearme.instant.platform/files/com.example.demo/profile.cpuprofile
</code></pre></div><ul><li>若没有 adb 也可以手动将手机内部存储/Android/data/com.nearme.instant.platform/files/com.example.demo/profile.cpuprofile 目录下的 profile.cpuprofile 文件拷贝到电脑上</li></ul> <h4 id="使用-chrome-的-performance-面板打开-profile-cpuprofile-文件即可"><a href="#使用-chrome-的-performance-面板打开-profile-cpuprofile-文件即可" class="header-anchor">#</a> 使用 chrome 的 performance 面板打开 profile.cpuprofile 文件即可</h4> <p><img src="data:image/png;base64,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" alt="load profile"> <img src="/scoring/assets/img/performance-app.9d63fd49.png" alt="http link"></p> <h3 id="通过-h5-预览查看火焰图"><a href="#通过-h5-预览查看火焰图" class="header-anchor">#</a> 通过 H5 预览查看火焰图</h3> <p>快应用除了在真机上进行原生渲染外，也支持在浏览器中查看 H5 模拟渲染的结果。虽然渲染的方式不同，但是各个 js 耗时相对的执行耗时不会相差太多，所以可以直接使用 chrome 的 performance 面板查看火焰图。</p> <ul><li>在命令行中执行以下命令</li></ul> <div class="language- extra-class"><pre class="language-text"><code>hap server
</code></pre></div><ul><li>执行后可以在命令行中看到生成 HTTP 服务器的地址，将其复制到 chrome 浏览器中打开，并点击打开页面中的打开 web 预览</li></ul> <p><img src="/scoring/assets/img/hap-server-log.03b9863b.png" alt="http link"></p> <p><img src="/scoring/assets/img/web-preview.7c134fbe.png" alt="web preview"></p> <ul><li>若操作无误的话即可在浏览器中看到 web 预览的快应用页面，如下图。此后调试和调试优化 H5 无异。</li></ul> <p><img src="/scoring/assets/img/preview-result.00751645.png" alt="preview"></p> <ul><li><p>点击页面中的 reload 按钮，等待 6s 左右停止录制即可</p></li> <li><p>获得的火焰图</p></li></ul> <p><img src="/scoring/assets/img/reload.ebdb1426.png" alt="preview"></p> <h2 id="通过火焰图优化耗时脚本"><a href="#通过火焰图优化耗时脚本" class="header-anchor">#</a> 通过火焰图优化耗时脚本</h2> <p>以 inspect 接口生成的火焰图为例，可以看到快应用启动有两个主要流程，createApp 和 cratePage，都能在火焰图中找到</p> <p><img src="data:image/png;base64,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" alt="create"></p> <p>开发者不需要关注其中陌生的函数执行，主要关注在火焰图底部是否有各个生命周期的宽度很宽，如果有的话则需要进行优化。</p> <p>需要关注的生命周期：</p> <ul><li>createApp 中的 onCreate</li> <li>createPage 中的 onInit、onReady</li></ul> <p>例如在 demo 生成的火焰图中,放大 createApp 部分可以明显看到 onCreate 占用 CPU 时间很多</p> <p><img src="/scoring/assets/img/onCreate.ebe9faa6.png" alt="onCreate"></p> <p>可以直接根据火焰图继续看调用栈或者直接看源码，看是哪个函数导致函数执行时间太长</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  showMenu<span class="token operator">:</span> $utils<span class="token punctuation">.</span>showMenu<span class="token punctuation">,</span>
  createShortcut<span class="token operator">:</span> $utils<span class="token punctuation">.</span>createShortcut<span class="token punctuation">,</span>
  <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token constant">APP_STATISTICS</span><span class="token punctuation">.</span><span class="token function">app_sta_init</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>demo 中 onCreate 执行时间过长是因为调用了一个统计工具的初始化方法，开发者在开发过程中可能是别的原因导致的。通常的做法是将初始化时不需要或非必要的方法，延后到 onShow 等生命周期中。</p> <p>本例中直接将该代码注释掉，模拟优化后的效果</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// APP_STATISTICS.app_sta_init(this)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>重新获取火焰图对比，可以明显看到 createApp 过程中 js 的执行时间从 29ms 降到了 10ms</p> <p><img src="/scoring/assets/img/app-before.98ac2ad5.png" alt="before"><img src="/scoring/assets/img/app-after.96150e21.png" alt="after"></p> <h2 id="其他优化手段"><a href="#其他优化手段" class="header-anchor">#</a> 其他优化手段</h2> <h3 id="console-log-语句"><a href="#console-log-语句" class="header-anchor">#</a> console.log 语句</h3> <p>在快应用运行时，控制台大量打印日志语可能会拖累 JavaScript 线程。注意有些第三方调试库也可能包含控制台打印语句，所以在发布应用前请务必仔细检查，删除不必要的 console 语句，或者直接将 manifest.json 中将 debug 选项改为 false。该场景与<a href="https://reactnative.dev/docs/performance#using-consolelog-statements" target="_blank" rel="noopener noreferrer">react native<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>类似。</p> <h3 id="优化-createpage-的时间"><a href="#优化-createpage-的时间" class="header-anchor">#</a> 优化 createPage 的时间</h3> <p>若 createPage 耗时过长且没有明显耗时的业务代码，调用栈中有较多的 appendChild 方法，则可能时节点数过多导致的，可以参考 dom 优化文档进行优化。</p> <h3 id="简化-viewmodel-的数据"><a href="#简化-viewmodel-的数据" class="header-anchor">#</a> 简化 ViewModel 的数据</h3> <p><a href="https://doc.quickapp.cn/tutorial/framework/optimization-skills.html?h=%E4%BC%98%E5%8C%96#%E7%AE%80%E5%8C%96viewmodel%E7%9A%84%E6%95%B0%E6%8D%AE" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>在 ViewModel 的定义中，属性 public、protected、private 主要承担数据驱动的数据定义与改造功能，会对赋值的数据中每个属性进行递归式的定义。因此，属性个数的定义越少越好，尤其是数组类型数据，建议过滤不需要用到的对象属</p> <h3 id="合理使用后代选择器"><a href="#合理使用后代选择器" class="header-anchor">#</a> 合理使用后代选择器</h3> <p><a href="https://doc.quickapp.cn/tutorial/framework/optimization-skills.html?h=%E4%BC%98%E5%8C%96#%E5%90%88%E7%90%86%E4%BD%BF%E7%94%A8%E5%90%8E%E4%BB%A3%E9%80%89%E6%8B%A9%E5%99%A8" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>框架支持 CSS 中的后代选择、支持 less 预编译，方便开发者开发，提升代码可维护性。然而，过多的使用后代选择器，也会在节点匹配上带来性能损耗，尤其是当一个节点满足多个选择时。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/scoring/" class="prev router-link-active">
        介绍
      </a></span> <span class="next"><a href="/scoring/guide/runtime-dom.html">
        DOM 优化
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/scoring/assets/js/app.1668d037.js" defer></script><script src="/scoring/assets/js/2.3be33aa9.js" defer></script><script src="/scoring/assets/js/3.e949fc0c.js" defer></script>
  </body>
</html>
