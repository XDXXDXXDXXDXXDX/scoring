(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{367:function(t,s,a){t.exports=a.p+"assets/img/webpack-build.740f4c98.png"},368:function(t,s,a){t.exports=a.p+"assets/img/lodash.dbf222b6.png"},369:function(t,s,a){t.exports=a.p+"assets/img/lodash-optimize.47bc266f.png"},370:function(t,s){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAByCAIAAAAXnYLjAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAHRUlEQVR4nO2cXUhbZxjHn/jRaaw1zA+GtvQIVaGhpRS00DRs6p0pdNMxSDRQPyrFuAvXRI0XQovEr0Io88hWtbZEc6Cg9KLpRWF2IBlOwYVCLmZHTbB23ao26kz8aLtdJLFaT8yHJ68n7vld5Zyc8543f1+evL6/cyI4eeo0IOEnar878H8BgyYEBk2ImERh0uZGYmLC8vLKPvbmAIMjmhAYNCEwaEJg0ITAoAmxH0HnXblJ62ryAOBSo+fFwSeG0HVK1HTe4t2GngkAGO9RjxO6LH/wM6LjRYnxPt45IvLxDsLG7kGfLtM0qxWndyQaf778WvN3X59hOeVSI60u9m4Ua/WNJZB7VUcXZMDhk5dpfWOJu3R8OMZN7lUdTetpWk9rL4X2SXjO7qXjaU/LUE2zUq0w3DQ+dXl2xp8vv1Z8Yna4xWAJ7BoTPzRNbC0dO4tyifpy5vRdVc9EcJ2PJPx9GbrGum8MzZ9Sesd1/Pnya8WZ9uGW/l9cfk4NgplF1+GkY9y1x0MCmHV4s9aWX/i8WlucaR9uNXCZMgCM96hHoJDW0ztKyoEhsOmda6z7xtCr7JKvjj7jPmU3QzdVqjrVCBS2X8kNQ/P7TsDTO9dYt3YsgONmlv75IrsEYAigRF14FGamgunOzKKrIOkYwMEr1pzPoye7xwvoAj1dAPDi559eZGS7dw+NWPOUl2l94Uhd28yOk0rUdEEGAAC4rPeahrnuEx8QnDsn3dzA9ejwgWsdhMCgCYFBEwKDJgQGTYiYhYW/NjeiolIWFuZ2HpSSkjI3x7IfCRwc0YTAoAmBQRMCgyYEBk0IPgUtre9jehukAFDa6nmxO6WtjLFVGf6OcUHIq3fRKn1qHix11TknTsTWXUk6kxoDACsv3tDNa9bAm1HqGKmjq7rDDACjHZWjrAeVtjIyym6SNw5u3z+olQ+ynsBDQl8mTRBGx4LgEESpvk3NTX3vmFl1bAgSXO+DSDkAJJre2rN/WyadkMxpu8TZ+3p0TJpIAKvOx+1LDxZ2Oay0lRFb5U0DAABQ1mYUWxUPP+utPSsEgFrGePGRQmur76sRPfEe48bcWWUGkGh62Yx7aSuT7+iuah91/z2EAAAsA58X7D3o9d+ev8vKSfzmVnz+H4v3v1817xb3NsydVeatpcN/UfaBUlebNdUl7zCH2gABOPgyfHD9Ff3QMbsclZqTrGpJkOy9xWCxOZyJokzy1w2GkIMWxMYCvIN1AAAwG1c0NX8+ngEQCfPOcda5QBntqHwEMsbIMLoy4hcPkBBKR4yq5XBGwiEqDpzP1iYguq7r03THxgYI0tIBNtamf+W+l/4xNMkNAEodc7t+upqPNST4EZ0TS6XHZSRFOZ7P/3jrLYBgffXftPS4jPRP1l++ud++9ID9NJtjmRK757xKnez4Hrosre/zNXJ5XEOCH9G/uzQVW2/seEur52j/p5nbR2VMkZEpArCbTHZK7N5tMFmkKu+sI+i+eFDqmCIKAACclu6qgd0P3icEWVnZmxu+1p35uh69bcrIc/j0L3iwKMXUsmN6v3sRIKRuROcWT61wWrqbePi9x0pEl45IIpJLR0SBQRMCgyYEBk0IDJoQGDQhMGhCYNCE4FPQaMHZIGTBP8hAsJk+Xj+KJAse+ohOEEbHCr0W/FjMyuvV2ZdrGxxb8NKLyU/kcoVcruiaTJPdrt8HT8YRPLfgg9pGzyvz2FTFWVEmgHlbm2jBAyA4C06JhHYr+9IzWnDOkNb3FaVZTD6GKo8N1iYRYMElml5GCXfkVe3sN4yhBecCiaa3Avrl1f6qAlpwLyFZcGl9RdbUnU7zRzvRgu9CSBacEgkTqVrGWOvdYWM9DC14mEELTga04GEHLTjii0guHREFBk0IDJoQGDQhMGhCYNCEwKAJgUETgk9BowVnAy14cPDcgksugMeCm+yUrK2Uy7bJwnMLbm73rvoPWG0y8c420YIHQFAWvExM2axN7O9FggXnYJn0wfVXrxUJX144kpGTrGpxQM0Klx/Ya09sjxRag49jbA5n0Ue3fPAO3ltwQ5O7RlvFRsbXnUpowTlkoNEkZsQ+hy1acC8hWvAG7zRZosn3iCu04LsSkgUfnRXVGJkiAABYtnT5GqpowcMMWnAyoAUPO2jBEV9EcumIKDBoQmDQhMCgCYFBEwKDJgQGTQgMmhB8ChotOBskfxEd3D+KnjZJV257cCiSLDjffxHdjUSTTwE4w9AyMXhuwQHA8xCcxX4mm6VNtOABEJgFlzQos6cMVbMy446gvUSCBef7s+BlbarsZ/0+H052w2ODtQm/LbhSJwNTZae/kYoWfG9IGqQUJFIMI/PsOK5i2ij2Esx7Cx580DmxVHpcGoDj+Xz/rbcAMW4LDgArL988vOf0bcFlYiWAwWPBbf5nJ+b2Lc/al7UZ8+fpyk4zSH18ZwKv76ThtwUPELTgYQYtOBnQgocdtOCILyK5dEQUGDQh/gOlF603FR1qUQAAAABJRU5ErkJggg=="},371:function(t,s){t.exports="data:image/png;base64,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"},385:function(t,s,a){"use strict";a.r(s);var n=a(42),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"脚本大小"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#脚本大小"}},[t._v("#")]),t._v(" 脚本大小")]),t._v(" "),n("p",[t._v("当引用了第三包的脚本或者没有按需引用公共的工具方法时，会导致不同页面含有相同的js脚本，导致整体包体积过大。")]),t._v(" "),n("p",[t._v("本文档借助webpack-bundle-analyzer完成对js文件的优化。")]),t._v(" "),n("h2",{attrs:{id:"分析包大小"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#分析包大小"}},[t._v("#")]),t._v(" 分析包大小")]),t._v(" "),n("p",[t._v("首先在项目中安装webpack-bundle-analyzer")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("npm install --save-dev webpack-bundle-analyzer\n")])])]),n("p",[t._v("在项目的根目录新建构建配置文件 quickapp.config.js 并添加以下内容")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" BundleAnalyzerPlugin "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'webpack-bundle-analyzer'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BundleAnalyzerPlugin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  plugins"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BundleAnalyzerPlugin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("执行hap build 即会在弹出的浏览器中展现可视化的包大小分析结果，单文件越大，那么他的方块也就越大")]),t._v(" "),n("p",[n("img",{attrs:{src:a(367),alt:"build"}})]),t._v(" "),n("p",[t._v("点击左边的菜单，将Treemap sizes切换到Stat，即可看到详细的文件大小占用情况")]),t._v(" "),n("p",[n("img",{attrs:{src:a(368),alt:"build"}})]),t._v(" "),n("p",[t._v("现实的开发场景下一般也只有两种脚本，一种是第三方的工具库，一种是开发者自己封装的函数，下面都给出对应的优化方式。")]),t._v(" "),n("p",[t._v("示例中，是在不同的页面都有引入了完整的lodash库导致了整体包体积过大。")]),t._v(" "),n("h2",{attrs:{id:"第三方库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第三方库"}},[t._v("#")]),t._v(" 第三方库")]),t._v(" "),n("p",[t._v("我们建议使用第三方库时，用按需引入的方式替代完整引入，如示例中我们打开 main-page 导入的 common.js 文件，将其引入loadsh方式做更改")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// var _ = require('lodash'); 不推荐的完整引入方式")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" _concat "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'lodash/concat'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("重新构建可以看到，相比于没有做此改动的app.ux文件，common.js直接小了400KB+！main-page中lodsh的占比已经小的微不足道了。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(369),alt:"build"}})]),t._v(" "),n("p",[t._v("如果项目中已经过多的引入导致修改比较繁杂，也可以借助 lodash-webpack-plugin，babel-plugin-lodash插件进行优化，推荐阅读其"),n("a",{attrs:{href:"https://www.npmjs.com/package/lodash-webpack-plugin",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),n("OutboundLink")],1)]),t._v(" "),n("h2",{attrs:{id:"工具脚本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#工具脚本"}},[t._v("#")]),t._v(" 工具脚本")]),t._v(" "),n("p",[t._v("项目中常常会维护一份utils.js，该文件会保存一些常用的工具的函数如")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// utils.js")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("util1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'util 1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("util2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'util 2'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("util3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'util 3'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("但是在使用时我们往往只需要其中的一个或两个函数")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// main-page/index.ux")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" util1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" util2 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../../../helper/utils.js'")]),t._v("\n")])])]),n("p",[t._v("但是在构建之后是会将utils.js完整引入到页面中的，包括那些你用不到的函数。在项目越来越复杂之后，每个方法也会越来越大导致最后utils臃肿不堪。")]),t._v(" "),n("p",[t._v("所以我们建议将工具方法拆分，尽量一个方法一个文件，引入方法时仅引入对应的一个文件即可")]),t._v(" "),n("p",[n("img",{attrs:{src:a(370),alt:"utils"}})]),t._v(" "),n("h2",{attrs:{id:"结构优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#结构优化"}},[t._v("#")]),t._v(" 结构优化")]),t._v(" "),n("p",[t._v("结构优化的目的是减小页面以及整体 rpk 包的体积，减少冗余代码。")]),t._v(" "),n("p",[t._v("对于一些常用的方法，不论是第三方的还是开发者自己编写的，我们建议将其暴露到全局中。")]),t._v(" "),n("p",[t._v("在使用分包的情况下，该优化方案需要注意不要将所有可能用到的、甚至可能只有一两个页面用到的方法都放到全局中，这将会导致首包过大反而减慢了加载速度。")]),t._v(" "),n("p",[t._v("我们提供了两种注入方式，让您在应用的任何地方都能调用到注入的方法")]),t._v(" "),n("h3",{attrs:{id:"注入到全局中"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#注入到全局中"}},[t._v("#")]),t._v(" 注入到全局中")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://doc.quickapp.cn/tutorial/framework/optimization-skills.html?h=%E4%BC%98%E5%8C%96#%E4%BD%BF%E7%94%A8-globaljs",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("假设开发者已经按照上面的方法将脚本拆分完毕，可以参考示例demo中 /src/helper/utils 文件夹")]),t._v(" "),n("p",[n("img",{attrs:{src:a(371),alt:"utils break"}})]),t._v(" "),n("p",[t._v("在utils文件夹下创建index.js，加入以下脚本将所有方法统一导出")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" files "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" require"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("context")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token regex"}},[n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("\\.js")]),n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" utils "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nfiles"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("keys")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./index.js'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  Object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("assign")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("files")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("default"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" utils\n")])])]),n("p",[t._v("新建 global.js文件，添加如下脚本将utils.js导出的对象注入到global的$utils中")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" utils "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./helper/utils/index.js'")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" hook2global "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPrototypeOf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("global"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" global\n\nhook2global"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$utils "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" utils "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 注入到全局中")]),t._v("\n")])])]),n("p",[t._v("最后在app.ux中引入 global.js 即可")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./global.js'")]),t._v("\n")])])]),n("p",[t._v("在任意页面即可直接调用注入的 $utils 对象上的方法")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// other.ux")]),t._v("\n$utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getByteLength")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'quickapp!'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("h3",{attrs:{id:"注入到app中"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#注入到app中"}},[t._v("#")]),t._v(" 注入到App中")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://doc.quickapp.cn/tutorial/framework/lifecycle.html#%E5%85%B3%E4%BA%8Eapp-%E4%B8%8Eappdef",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("快应用中提供$app.$def对象，$app.$def代表开发者在 app.ux 中导出的对象（即export default导出的内容），可以放置业务相关的全局数据和方法；")]),t._v(" "),n("p",[t._v("参考示例，在app.ux中添加如下代码")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" utils "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./helper/utils/index.js'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 导入utils对象")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将utils对象中的部分属性导出供其他页面使用")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  showMenu"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("showMenu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  createShortcut"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("createShortcut\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("在其他页面中，通过this.$app.$def.[method Name]调用即可，如")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// other.ux")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("onInit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$def"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createShortcut")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"独立打包javascript"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#独立打包javascript"}},[t._v("#")]),t._v(" 独立打包javascript")]),t._v(" "),n("p",[t._v("针对上面重复引入的问题，快应用平台自1080版本起支持 JS 资源独立打包，当 app.ux 或页面文件两次或以上引用到同一 JS 资源时，会将该 JS 资源抽取到独立的文件中，使得相关文件共用同一份 JS 代码。详细说明可以查看"),n("a",{attrs:{href:"https://doc.quickapp.cn/framework/js-split.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),n("OutboundLink")],1),t._v("。")])])}),[],!1,null,null,null);s.default=e.exports}}]);